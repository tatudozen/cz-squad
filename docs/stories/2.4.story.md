# Story 2.4: Visual Design Brief Generator

**Epic:** 2 - Content Generation System (Posts)
**Story ID:** 2.4
**Status:** Ready for Review
**Priority:** P0 (Follows 2.3)
**Story Points:** 8

## Story Statement

**As a** operator (OPB),
**I want** to generate detailed visual design briefs for carousel slides and static posts from brand profile and carousel/post data,
**so that** designers have clear, actionable guidelines for creating on-brand visual assets.

## Acceptance Criteria

1. Module `apps/api/services/content/generators/design-brief.ts` with function `generateDesignBrief(carousel | post, brandProfile, clientId, options?)`
2. Output structured: color palette specs, typography guidelines, layout suggestions, imagery style, design notes per slide
3. Design brief includes: hex colors with usage (primary, secondary, accent), font recommendations, spacing guidelines, visual metaphors
4. Instagram carousel briefs: per-slide design notes + overall aesthetic direction
5. Static post briefs: single comprehensive brief for image placement and composition
6. Branding consistency: applies color palette and voice guidelines from brand profile
7. Responsive design considerations: mobile-first approach, scaling guidelines
8. Tests with mocks validating output structure and branding consistency

## Scope

### In Scope
- Visual design brief generation for carousels
- Visual design brief generation for static posts
- Color palette extraction and specification
- Typography and spacing guidelines
- Layout and composition recommendations
- Design notes generation (actionable, emoji-based)
- Responsive design considerations
- Branding consistency validation
- LLM-based brief generation
- REST API endpoint with Zod validation
- Test coverage for all content types

### Out of Scope
- Actual image generation or rendering
- Design file creation (Figma, Adobe, etc.)
- Frontend component rendering (Story 2.5)
- Multi-language support (future enhancement)
- n8n workflow integration (Story 1.6)
- Brand profile modification

## Dependencies

**Prerequisite Stories:**
- Story 2.1 (Content Strategy & Planning Module) - ✅ DONE
- Story 2.2 (Carousel Copy Generator) - ✅ DONE
- Story 2.3 (Static Post Copy Generator) - ✅ DONE
- Story 1.4 (Brand Profile Generation) - ✅ DONE
- Story 1.5 (Copywriting Agent - LLM Setup) - ✅ DONE

**Technical Dependencies:**
- LLM Adapter (Claude API wrapper)
- Carousel type from Story 2.2
- StaticPost type from Story 2.3
- BrandProfile type from Story 1.4
- Zod validation library

## Dev Notes

### Architecture Context

**Design Brief Generator Role:**
The Design Brief Generator is the **fourth step** in Epic 2's content generation pipeline. It takes carousel or static post data (from Stories 2.2-2.3) and generates detailed visual design briefs that guide designers in creating on-brand visual assets.

**API Specification:**
```typescript
POST /content/design-brief/carousel
Payload: {
  carousel_id: UUID,          // Reference to carousel from Story 2.2
  brand_profile_id: UUID
}
Response: {
  id: UUID,
  carousel_id: UUID,
  brand_profile_id: UUID,
  content_type: "carousel",
  color_palette: [{name, hex, usage}],
  typography: {heading: string, body: string, accent?: string},
  spacing_guidelines: string,
  layout_guidelines: string,
  imagery_style: string,
  slides_briefs: [{slide_number, design_note, composition, color_focus}],
  overall_aesthetic: string,
  created_at: ISO 8601,
  updated_at: ISO 8601
}

POST /content/design-brief/static-post
Payload: {
  post_id: UUID,              // Reference to post from Story 2.3
  brand_profile_id: UUID
}
Response: {
  id: UUID,
  post_id: UUID,
  brand_profile_id: UUID,
  content_type: "static-post",
  platform: "instagram" | "linkedin",
  color_palette: [{name, hex, usage}],
  typography: {heading: string, body: string, accent?: string},
  image_composition: string,
  focal_point: string,
  text_overlay_guidelines: string,
  imagery_style: string,
  responsive_notes: string,
  created_at: ISO 8601,
  updated_at: ISO 8601
}
```

**Key Technical Decisions:**
1. **Separate Endpoints**: Carousel and static post briefs have different structures and requirements
2. **Color Specifications**: Hex codes with usage guidelines (primary, secondary, accent, background)
3. **Typography**: Specific font recommendations with size/weight guidance
4. **Actionable Notes**: Design notes must be specific enough for designer implementation
5. **Responsive Design**: Include mobile-first and scaling considerations
6. **LLM Integration**: Use Claude to generate context-aware design recommendations based on brand + content

### File Locations & Naming Conventions

**New Files to Create:**
- `apps/api/src/services/content/generators/design-brief.ts` — Main design brief generation service
- `apps/api/src/routes/design-brief.ts` — POST /content/design-brief/* endpoints
- `apps/api/src/services/content/__tests__/design-brief.test.ts` — Unit + E2E tests
- `apps/api/src/types/design-brief.ts` — TypeScript interfaces (if separate file)

**Modified Files:**
- `apps/api/src/index.ts` — Add design-brief router

---

## Tasks / Subtasks

- [ ] Task 1: Create `design-brief.ts` service module with generation functions (AC: 1, 2, 3, 4, 5)
  - [ ] Define TypeScript interfaces: DesignBrief, CarouselBrief, StaticPostBrief, ColorSpec, TypographyGuide
  - [ ] Implement `generateCarouselBrief()` function
  - [ ] Implement `generateStaticPostBrief()` function
  - [ ] Add color palette extraction from brand profile
  - [ ] Add typography guidelines application
  - [ ] Add responsive design considerations

- [ ] Task 2: Create REST API endpoints (AC: 1)
  - [ ] POST /content/design-brief/carousel endpoint with Zod validation
  - [ ] POST /content/design-brief/static-post endpoint with Zod validation
  - [ ] Error handling and validation
  - [ ] Request/response transformation

- [ ] Task 3: Implement unit and E2E tests (AC: 8)
  - [ ] Test carousel design brief generation
  - [ ] Test static post design brief generation (Instagram)
  - [ ] Test static post design brief generation (LinkedIn)
  - [ ] Test color palette specification
  - [ ] Test typography guidelines
  - [ ] Test responsive design notes
  - [ ] Test branding consistency
  - [ ] Test error scenarios

- [ ] Task 4: Code quality validation (AC: 8)
  - [ ] ESLint passes: `npm run lint`
  - [ ] TypeScript passes: `npm run typecheck`
  - [ ] All tests pass: `npm run test`
  - [ ] Update File List in story

---

## Testing

**Test Framework:** Vitest
**Test Location:** `apps/api/src/services/content/__tests__/design-brief.test.ts`
**Coverage Target:** 80%+

**Test Scenarios:**
- Carousel design brief generation
- Static post design brief generation (Instagram)
- Static post design brief generation (LinkedIn)
- Color palette specification and usage
- Typography guidelines
- Layout and composition suggestions
- Responsive design considerations
- Branding consistency application
- Error handling

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-26 | 1.0 | Story created from PRD Epic 2.4 | @dev |

---

## Dev Agent Record

### Agent Model Used
Claude Haiku 4.5 (claude-haiku-4-5-20251001)

### Debug Log References
- Session: Story 2.4 Creation
- Date: 2026-02-26

### Completion Notes List
- ✅ Task 1: generateCarouselDesignBrief() service with LLM integration (complete)
- ✅ Task 1b: generateStaticPostDesignBrief() service for Instagram/LinkedIn (complete)
- ✅ Task 2: REST API endpoints POST /design-brief/carousel and /static-post (complete)
- ✅ Task 3: Unit + E2E test suite with 17 tests (all passing)
- ✅ Task 4: Code quality validation (lint OK, typecheck OK, tests 17/17 passing)

### File List

**New Files Created:**
- `apps/api/src/services/content/generators/design-brief.ts` (294 lines) - Design brief generation service with LLM integration
- `apps/api/src/routes/design-brief.ts` (158 lines) - REST endpoints for carousel and static post design briefs
- `apps/api/src/services/content/__tests__/design-brief.test.ts` (360 lines) - Comprehensive test suite (17 tests)

**Modified Files:**
- `apps/api/src/index.ts` - Added design-brief router import and registration

**Total Lines Added:** 812 lines of code
**Total Files Created:** 3 files
**Modified Files:** 1 file

---

## QA Results

*To be populated by @qa during review*

---

## ClickUp Integration

```yaml
clickup:
  task_id: ""
  epic_task_id: ""
  list: "Backlog"
  url: ""
  last_sync: ""
```
