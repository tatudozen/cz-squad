# Story 2.3: Static Post Copy Generator

**Epic:** 2 - Content Generation System (Posts)
**Story ID:** 2.3
**Status:** Ready for Review
**Priority:** P0 (Follows 2.2)
**Story Points:** 8

## Story Statement

**As a** operator (OPB),
**I want** to generate complete copy for static Instagram and LinkedIn posts from a content plan item,
**so that** the output is publishable, follows platform-specific conventions, and respects the strategy defined in the plan.

## Acceptance Criteria

1. Module `apps/api/services/content/generators/static-post.ts` with function `generateStaticPost(planItem, brandProfile, clientId, options?)`
2. Output structured: main copy (platform-specific length), design note (visual suggestion), hashtags
3. Instagram posts: max 2200 chars total, 10-30 hashtags, emoji support
4. LinkedIn posts: max 3000 chars, professional tone, 3-5 hashtags only
5. Inception mode: educational tone, soft CTA (follow, connect, learn more)
6. Atração Fatal mode: urgency/curiosity tone, direct CTA to FunWheel link
7. Each post includes: main text (platform-specific limits), design note (visual suggestion), platform indicator
8. Branding guardrails applied via Copywriting Agent (tone, vocabulary, persona)
9. Tests with mocks validating output structure and platform-specific constraints
10. REST API endpoint `POST /content/static-post` with request/response validation using Zod

## Scope

### In Scope
- Static post copy generation service (Instagram + LinkedIn)
- LLM-based copy generation via Claude API
- Platform-specific formatting (Instagram vs LinkedIn)
- Branding guardrail application
- Character limit validation (2200 Instagram, 3000 LinkedIn)
- Hashtag generation (Instagram 10-30, LinkedIn 3-5)
- Design note generation (visual suggestion for single image)
- Test coverage for all modes and platforms
- REST API endpoint with Zod validation

### Out of Scope
- Visual design generation (Story 2.4)
- Image generation or editing
- Multi-language support (future enhancement)
- Batch post generation (future enhancement)
- n8n workflow integration (Story 1.6)
- TikTok, Facebook, or Twitter support (future platforms)

## Dependencies

**Prerequisite Stories:**
- Story 2.1 (Content Strategy & Planning Module) - ✅ DONE
- Story 2.2 (Carousel Copy Generator) - ✅ DONE
- Story 1.2 (Supabase Schema) - ✅ DONE
- Story 1.4 (Brand Profile Generation) - ✅ DONE
- Story 1.5 (Copywriting Agent - LLM Setup) - ✅ DONE

**Technical Dependencies:**
- LLM Adapter (Claude API wrapper)
- ContentPlanPost interface from Story 2.1
- Zod validation library
- BrandProfile type from Story 1.4

## Dev Notes

### Architecture Context

**Static Post Generator Role:**
The Static Post Generator is the **third step** in Epic 2's content generation pipeline. It takes an individual post plan from Story 2.1 and generates platform-specific static post copy (Instagram or LinkedIn) that is ready for publishing or visual enhancement (Story 2.4).

**API Specification:**
```typescript
POST /content/static-post
Payload: {
  plan_item_id: UUID,        // Reference to post from content plan
  brand_profile_id: UUID,
  platform: "instagram" | "linkedin",
  options?: {
    style?: "educational" | "promotional" | "narrative"
  }
}
Response: {
  id: UUID,
  plan_item_id: UUID,
  brand_profile_id: UUID,
  client_id: UUID,
  mode: "inception" | "atração-fatal",
  platform: "instagram" | "linkedin",
  main_text: string,         // platform-specific length
  hashtags: string[],        // array of hashtags
  design_note: string,       // visual suggestion for image
  character_count: number,   // actual character count
  hashtag_count: number,     // hashtag count
  created_at: ISO 8601,
  updated_at: ISO 8601
}
```

**Key Technical Decisions:**
1. **Platform Separation**: Instagram and LinkedIn have different copy constraints, tone, and hashtag conventions
2. **Copy Constraints**: 2200 chars Instagram, 3000 chars LinkedIn, enforced programmatically post-generation
3. **Hashtag Strategy**: Instagram 10-30 hashtags for reach, LinkedIn 3-5 for professionalism
4. **Branding Application**: Use brand_profile.voiceGuidelines in LLM prompt
5. **Mode Distinction**: Inception vs Atração Fatal affects CTA approach and urgency tone
6. **Design Note**: Single image placeholder instruction (emojis + composition hints)

### File Locations & Naming Conventions

**New Files to Create:**
- `apps/api/src/services/content/generators/static-post.ts` — Main static post generation service
- `apps/api/src/routes/static-post.ts` — POST /content/static-post endpoint
- `apps/api/src/services/content/__tests__/static-post.test.ts` — Unit + E2E tests
- `apps/api/src/types/static-post.ts` — TypeScript interfaces (if separate file)

**Modified Files:**
- `apps/api/src/index.ts` — Add static-post router
- `apps/api/src/types/content.ts` — Add StaticPost, StaticPostOptions types (or in separate file)

---

## Tasks / Subtasks

- [ ] Task 1: Create `static-post.ts` service module with `generateStaticPost()` function (AC: 1, 2, 3, 4, 5)
  - [ ] Define TypeScript interfaces: StaticPost, StaticPostOptions, PlatformConfig
  - [ ] Implement function signature
  - [ ] Add platform-specific length validation (2200 Instagram, 3000 LinkedIn)
  - [ ] Implement LLM prompt for static post generation
  - [ ] Add branding guardrail application
  - [ ] Implement hashtag generation (10-30 Instagram, 3-5 LinkedIn)

- [ ] Task 2: Create REST API endpoint `POST /content/static-post` (AC: 1, 10)
  - [ ] Define Zod request schema (plan_item_id, brand_profile_id, platform, style)
  - [ ] Implement request validation
  - [ ] Fetch plan item from content_plans
  - [ ] Fetch brand profile
  - [ ] Call static post generation service
  - [ ] Return structured response with character count and hashtag count
  - [ ] Error handling

- [ ] Task 3: Implement unit and E2E tests (AC: 9)
  - [ ] Test Instagram post generation (2200 char limit)
  - [ ] Test LinkedIn post generation (3000 char limit)
  - [ ] Test Inception mode (soft CTA)
  - [ ] Test Atração Fatal mode (direct FunWheel CTA)
  - [ ] Test character limit enforcement
  - [ ] Test hashtag generation (Instagram 10-30, LinkedIn 3-5)
  - [ ] Test design note generation
  - [ ] Test error scenarios (invalid plan_item_id, missing brand profile)
  - [ ] Mock LLM responses for deterministic testing

- [ ] Task 4: Code quality validation (AC: 9)
  - [ ] ESLint passes: `npm run lint`
  - [ ] TypeScript passes: `npm run typecheck`
  - [ ] All tests pass: `npm run test`
  - [ ] Update File List in story

---

## Testing

**Test Framework:** Vitest
**Test Location:** `apps/api/src/services/content/__tests__/static-post.test.ts`
**Coverage Target:** 80%+

**Test Scenarios:**
- Instagram post generation (2200 char limit)
- LinkedIn post generation (3000 char limit)
- Inception mode with soft CTA
- Atração Fatal mode with FunWheel CTA
- Character limit enforcement per platform
- Hashtag generation (Instagram 10-30, LinkedIn 3-5)
- Design note generation
- Platform-specific formatting
- Error handling (invalid inputs)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-26 | 1.0 | Story created from PRD Epic 2.3 | @dev |

---

## Dev Agent Record

### Agent Model Used
Claude Haiku 4.5 (claude-haiku-4-5-20251001)

### Debug Log References
- Session: Story 2.3 Creation
- Date: 2026-02-26

### Completion Notes List
- ✅ Task 1: generateStaticPost() service with LLM integration (complete)
- ✅ Task 2: REST API endpoint POST /static-post (complete)
- ✅ Task 3: Unit + E2E test suite with 22 tests (all passing)
- ✅ Task 4: Code quality validation (lint, typecheck, tests all pass)

### File List

**New Files Created:**
- `apps/api/src/services/content/generators/static-post.ts` (256 lines) - Static post generation service with LLM integration
- `apps/api/src/routes/static-post.ts` (112 lines) - POST /static-post REST endpoint with Zod validation
- `apps/api/src/services/content/__tests__/static-post.test.ts` (384 lines) - Comprehensive test suite (22 tests)

**Modified Files:**
- `apps/api/src/index.ts` - Added static-post router import and registration

**Total Lines Added:** 752 lines of code
**Total Files Created:** 3 files
**Modified Files:** 1 file

---

## QA Results

*To be populated by @qa during review*

---

## ClickUp Integration

```yaml
clickup:
  task_id: ""
  epic_task_id: ""
  list: "Backlog"
  url: ""
  last_sync: ""
```
