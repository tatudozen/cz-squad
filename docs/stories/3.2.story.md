# Story 3.2: FunWheel Etapa R - Retenção (Lead Capture Form)

**Epic:** 3 - FunWheel Funnel System
**Story ID:** 3.2
**Status:** Ready for Review
**Priority:** P0
**Story Points:** 8

## Story Statement

**As a** operator (OPB),
**I want** to implement a lead capture form (Etapa R - Retenção) with lead magnet (PDF of presentation),
**so that** interested prospects provide contact info and receive the lead magnet as next step in the funnel.

## Acceptance Criteria

1. Lead capture form service: `apps/api/services/funwheel/generators/retention.ts`
2. Form fields: name (required), email (required), phone (required), optional qualifier field
3. Lead magnet: PDF generation from presentation content (MVP)
4. Collected leads stored in Supabase `funwheel_leads` table with RLS
5. Email validation, phone formatting, duplicate prevention
6. REST API endpoint `POST /funwheel/retention` with validation
7. Thank you page redirect with lead magnet download link
8. Tests covering form validation, storage, and error handling

## Scope

### In Scope
- Lead capture form service
- Form validation (email, phone)
- PDF lead magnet generation
- Lead storage in Supabase
- Webhook trigger for CRM (basic)
- REST API endpoint
- Error handling

### Out of Scope
- Advanced PDF customization
- Email automation (Story 3.5)
- CRM integration (Story 3.5)
- Lead scoring
- Qualification quiz (Etapa T)

## Dependencies

**Prerequisite:**
- Story 3.1 (FunWheel Etapa A) - ✅ DONE

**Technical:**
- Supabase client
- Zod validation
- PDF generation library

## Dev Notes

### Structure

**Form Fields:**
1. Name (text, required)
2. Email (email, required)
3. Phone (tel, required, formatted)
4. Qualifier (optional, custom per client)

**Lead Storage:**
- Table: `funwheel_leads`
- RLS: Isolate by client_id
- Fields: id, presentation_id, name, email, phone, qualifier, created_at

**PDF Lead Magnet:**
- Generated from presentation content
- Branded with client logo/colors
- Download link sent in thank you page

### API

```typescript
POST /funwheel/retention
{
  presentation_id: UUID,
  brand_profile_id: UUID,
  name: string,
  email: string,
  phone: string,
  qualifier?: string
}
Response: {
  id: UUID,
  lead_magnet_url: string,
  thank_you_page_url: string
}
```

## Tasks

- [ ] Task 1: Create retention service (AC: 1, 2, 3, 4)
- [ ] Task 2: Implement REST API endpoint (AC: 6)
- [ ] Task 3: PDF generation and storage
- [ ] Task 4: Tests (AC: 8)

## QA Results

*To be populated by @qa*
